<section class="py-24 relative overflow-hidden" id="testimonials">
  <!-- Background Decoration -->
  <div class="glow-safe glow-green w-[500px] h-[500px] -bottom-24 -left-24 opacity-40"></div>

  <div class="container mx-auto px-6 relative z-10">
    <h2 class="text-4xl font-bold mb-4 text-center text-white">Cosa Dicono i Clienti ⭐</h2>
    <p class="text-gray-400 text-center max-w-2xl mx-auto mb-16">
      La soddisfazione dei nostri clienti è la nostra migliore referenza
    </p>

    <div *ngIf="!loading && testimonials.length > 0" class="max-w-4xl mx-auto">
      <!-- Carousel Container -->
      <div class="relative">
        <!-- Navigation Arrows -->
        <button (click)="prev()" 
                class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 md:-translate-x-12 z-20 p-3 rounded-full bg-white/10 hover:bg-blue-600 text-white transition-all hover:scale-110">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
          </svg>
        </button>
        
        <button (click)="next()" 
                class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 md:translate-x-12 z-20 p-3 rounded-full bg-white/10 hover:bg-blue-600 text-white transition-all hover:scale-110">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        </button>

        <!-- Testimonial Card -->
        <div class="glass-panel rounded-3xl p-8 md:p-12 border border-white/10 shadow-2xl">
          <div *ngFor="let testimonial of testimonials; let i = index" 
               [class.hidden]="i !== currentIndex"
               class="testimonial-slide">
            
            <!-- Quote Icon -->
            <div class="text-6xl text-blue-400/20 mb-6">"</div>

            <!-- Rating Stars -->
            <div class="flex gap-1 mb-6 justify-center">
              <svg *ngFor="let filled of getStars(testimonial.rating)" 
                   xmlns="http://www.w3.org/2000/svg" 
                   [class.fill-yellow-400]="filled"
                   [class.fill-gray-600]="!filled"
                   viewBox="0 0 24 24" 
                   class="w-6 h-6">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>

            <!-- Quote Text -->
            <blockquote class="text-xl md:text-2xl text-gray-200 leading-relaxed mb-8 text-center font-light italic">
              {{testimonial.quote}}
            </blockquote>

            <!-- Client Info -->
            <div class="flex flex-col items-center gap-4">
              <!-- Client Logo/Avatar -->
              <div *ngIf="getImageUrl(testimonial)" 
                   class="w-16 h-16 rounded-full overflow-hidden border-2 border-blue-500/30">
                <img [src]="getImageUrl(testimonial)" 
                     [alt]="testimonial.client_name" 
                     class="w-full h-full object-cover logo-filter">
              </div>
              <div *ngIf="!getImageUrl(testimonial)" 
                   class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold">
                {{testimonial.client_name.charAt(0)}}
              </div>

              <!-- Name & Company -->
              <div class="text-center">
                <div class="font-bold text-white text-lg">{{testimonial.client_name}}</div>
                <div *ngIf="testimonial.client_company" class="text-gray-400 text-sm">
                  {{testimonial.client_company}}
                </div>
                <div *ngIf="testimonial.project_type" 
                     class="mt-2 inline-block px-3 py-1 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-xs font-medium">
                  {{testimonial.project_type}}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Dots Navigation -->
        <div class="flex justify-center gap-2 mt-8">
          <button *ngFor="let testimonial of testimonials; let i = index"
                  (click)="goTo(i)"
                  [class.bg-blue-500]="i === currentIndex"
                  [class.bg-white/20]="i !== currentIndex"
                  [class.w-8]="i === currentIndex"
                  class="h-2 w-2 rounded-full transition-all duration-300 hover:bg-blue-400">
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-12">
      <div class="inline-block w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
      <p class="text-gray-400 mt-4">Caricamento testimonianze...</p>
    </div>
  </div>
</section>
